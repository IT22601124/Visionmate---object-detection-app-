{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.capture = capture;\nexports.captureImage = captureImage;\nexports.captureImageContext = captureImageContext;\nexports.captureImageData = captureImageData;\nexports.compareStreams = compareStreams;\nexports.getIdealConstraints = getIdealConstraints;\nexports.getImageSize = getImageSize;\nexports.getPreferredStreamDevice = getPreferredStreamDevice;\nexports.getStreamDevice = getStreamDevice;\nexports.hasValidConstraints = hasValidConstraints;\nexports.isCapabilityAvailable = isCapabilityAvailable;\nexports.isWebKit = isWebKit;\nexports.setVideoSource = setVideoSource;\nexports.stopMediaStream = stopMediaStream;\nexports.syncTrackCapabilities = syncTrackCapabilities;\nexports.toDataURL = toDataURL;\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\nvar _invariant = _interopRequireDefault(require(\"invariant\"));\nvar CapabilityUtils = _interopRequireWildcard(require(\"./WebCapabilityUtils\"));\nvar _WebConstants = require(\"./WebConstants\");\nvar _WebUserMediaManager = require(\"./WebUserMediaManager\");\nvar _Camera = require(\"../legacy/Camera.types\");\nfunction _getRequireWildcardCache(e) { if (\"function\" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(e) { return e ? t : r; })(e); }\nfunction _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || \"object\" != typeof e && \"function\" != typeof e) return { default: e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if (\"default\" !== u && {}.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n.default = e, t && t.set(e, n), n; }\nfunction getImageSize(videoWidth, videoHeight, scale) {\n  var width = videoWidth * scale;\n  var ratio = videoWidth / width;\n  var height = videoHeight / ratio;\n  return {\n    width: width,\n    height: height\n  };\n}\nfunction toDataURL(canvas, imageType, quality) {\n  (0, _invariant.default)(Object.values(_Camera.ImageType).includes(imageType), `expo-camera: ${imageType} is not a valid ImageType. Expected a string from: ${Object.values(_Camera.ImageType).join(', ')}`);\n  var format = _WebConstants.ImageTypeFormat[imageType];\n  if (imageType === _Camera.ImageType.jpg) {\n    (0, _invariant.default)(quality <= 1 && quality >= 0, `expo-camera: ${quality} is not a valid image quality. Expected a number from 0...1`);\n    return canvas.toDataURL(format, quality);\n  } else {\n    return canvas.toDataURL(format);\n  }\n}\nfunction hasValidConstraints(preferredCameraType, width, height) {\n  return preferredCameraType !== undefined && width !== undefined && height !== undefined;\n}\nfunction ensureCameraPictureOptions(config) {\n  var captureOptions = {\n    scale: 1,\n    imageType: _Camera.ImageType.png,\n    isImageMirror: false\n  };\n  for (var key in config) {\n    if (key in config && config[key] !== undefined && key in captureOptions) {\n      captureOptions[key] = config[key];\n    }\n  }\n  return captureOptions;\n}\nvar DEFAULT_QUALITY = 0.92;\nfunction captureImageData(video) {\n  var pictureOptions = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  if (!video || video.readyState !== video.HAVE_ENOUGH_DATA) {\n    return null;\n  }\n  var canvas = captureImageContext(video, pictureOptions);\n  var context = canvas.getContext('2d', {\n    alpha: false\n  });\n  if (!context || !canvas.width || !canvas.height) {\n    return null;\n  }\n  var imageData = context.getImageData(0, 0, canvas.width, canvas.height);\n  return imageData;\n}\nfunction captureImageContext(video, _ref) {\n  var _ref$scale = _ref.scale,\n    scale = _ref$scale === void 0 ? 1 : _ref$scale,\n    _ref$isImageMirror = _ref.isImageMirror,\n    isImageMirror = _ref$isImageMirror === void 0 ? false : _ref$isImageMirror;\n  var videoWidth = video.videoWidth,\n    videoHeight = video.videoHeight;\n  var _getImageSize = getImageSize(videoWidth, videoHeight, scale),\n    width = _getImageSize.width,\n    height = _getImageSize.height;\n  var canvas = document.createElement('canvas');\n  canvas.width = width;\n  canvas.height = height;\n  var context = canvas.getContext('2d', {\n    alpha: false\n  });\n  if (!context) {\n    throw new Error('Context is not defined');\n  }\n  if (isImageMirror) {\n    context.setTransform(-1, 0, 0, 1, canvas.width, 0);\n  }\n  context.drawImage(video, 0, 0, width, height);\n  return canvas;\n}\nfunction captureImage(video, pictureOptions) {\n  var config = ensureCameraPictureOptions(pictureOptions);\n  var canvas = captureImageContext(video, config);\n  var imageType = config.imageType,\n    _config$quality = config.quality,\n    quality = _config$quality === void 0 ? DEFAULT_QUALITY : _config$quality;\n  return toDataURL(canvas, imageType, quality);\n}\nfunction getSupportedConstraints() {\n  if (navigator.mediaDevices && navigator.mediaDevices.getSupportedConstraints) {\n    return navigator.mediaDevices.getSupportedConstraints();\n  }\n  return null;\n}\nfunction getIdealConstraints(preferredCameraType, width, height) {\n  var preferredConstraints = {\n    audio: false,\n    video: {}\n  };\n  if (hasValidConstraints(preferredCameraType, width, height)) {\n    return _WebConstants.MinimumConstraints;\n  }\n  var supports = getSupportedConstraints();\n  if (!supports || !supports.facingMode || !supports.width || !supports.height) {\n    return _WebConstants.MinimumConstraints;\n  }\n  if (preferredCameraType && Object.values(_Camera.CameraType).includes(preferredCameraType)) {\n    var facingMode = _WebConstants.CameraTypeToFacingMode[preferredCameraType];\n    if (isWebKit()) {\n      var key = facingMode === 'user' ? 'exact' : 'ideal';\n      preferredConstraints.video.facingMode = (0, _defineProperty2.default)({}, key, facingMode);\n    } else {\n      preferredConstraints.video.facingMode = {\n        ideal: _WebConstants.CameraTypeToFacingMode[preferredCameraType]\n      };\n    }\n  }\n  if (isMediaTrackConstraints(preferredConstraints.video)) {\n    preferredConstraints.video.width = width;\n    preferredConstraints.video.height = height;\n  }\n  return preferredConstraints;\n}\nfunction isMediaTrackConstraints(input) {\n  return input && typeof input.video !== 'boolean';\n}\nfunction getPreferredStreamDevice(_x, _x2, _x3) {\n  return _getPreferredStreamDevice.apply(this, arguments);\n}\nfunction _getPreferredStreamDevice() {\n  _getPreferredStreamDevice = (0, _asyncToGenerator2.default)(function* (preferredCameraType, preferredWidth, preferredHeight) {\n    try {\n      return yield getStreamDevice(preferredCameraType, preferredWidth, preferredHeight);\n    } catch (error) {\n      if (error instanceof OverconstrainedError && error.constraint === 'facingMode') {\n        var nextCameraType = preferredCameraType === _Camera.CameraType.back ? _Camera.CameraType.front : _Camera.CameraType.back;\n        return yield getStreamDevice(nextCameraType, preferredWidth, preferredHeight);\n      }\n      throw error;\n    }\n  });\n  return _getPreferredStreamDevice.apply(this, arguments);\n}\nfunction getStreamDevice(_x4, _x5, _x6) {\n  return _getStreamDevice.apply(this, arguments);\n}\nfunction _getStreamDevice() {\n  _getStreamDevice = (0, _asyncToGenerator2.default)(function* (preferredCameraType, preferredWidth, preferredHeight) {\n    var constraints = getIdealConstraints(preferredCameraType, preferredWidth, preferredHeight);\n    var stream = yield (0, _WebUserMediaManager.requestUserMediaAsync)(constraints);\n    return stream;\n  });\n  return _getStreamDevice.apply(this, arguments);\n}\nfunction isWebKit() {\n  return /WebKit/.test(navigator.userAgent) && !/Edg/.test(navigator.userAgent);\n}\nfunction compareStreams(a, b) {\n  if (!a || !b) {\n    return false;\n  }\n  var settingsA = a.getTracks()[0].getSettings();\n  var settingsB = b.getTracks()[0].getSettings();\n  return settingsA.deviceId === settingsB.deviceId;\n}\nfunction capture(video, settings, config) {\n  var base64 = captureImage(video, config);\n  var capturedPicture = {\n    uri: base64,\n    base64: base64,\n    width: 0,\n    height: 0\n  };\n  if (settings) {\n    var _settings$width = settings.width,\n      width = _settings$width === void 0 ? 0 : _settings$width,\n      _settings$height = settings.height,\n      height = _settings$height === void 0 ? 0 : _settings$height;\n    capturedPicture.width = width;\n    capturedPicture.height = height;\n    capturedPicture.exif = settings;\n  }\n  if (config.onPictureSaved) {\n    config.onPictureSaved(capturedPicture);\n  }\n  return capturedPicture;\n}\nfunction syncTrackCapabilities(_x7, _x8) {\n  return _syncTrackCapabilities.apply(this, arguments);\n}\nfunction _syncTrackCapabilities() {\n  _syncTrackCapabilities = (0, _asyncToGenerator2.default)(function* (cameraType, stream) {\n    var settings = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    if (stream != null && stream.getVideoTracks) {\n      yield Promise.all(stream.getVideoTracks().map(function (track) {\n        return onCapabilitiesReady(cameraType, track, settings);\n      }));\n    }\n  });\n  return _syncTrackCapabilities.apply(this, arguments);\n}\nfunction onCapabilitiesReady(_x9, _x10) {\n  return _onCapabilitiesReady.apply(this, arguments);\n}\nfunction _onCapabilitiesReady() {\n  _onCapabilitiesReady = (0, _asyncToGenerator2.default)(function* (cameraType, track) {\n    var settings = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    if (typeof track.getCapabilities !== 'function') {\n      return;\n    }\n    var capabilities = track.getCapabilities();\n    var constraints = {};\n    var clampedValues = ['exposureCompensation', 'colorTemperature', 'iso', 'brightness', 'contrast', 'saturation', 'sharpness', 'focusDistance', 'zoom'];\n    for (var property of clampedValues) {\n      if (capabilities[property]) {\n        constraints[property] = convertNormalizedSetting(capabilities[property], settings[property]);\n      }\n    }\n    function validatedInternalConstrainedValue(constraintKey, settingsKey, converter) {\n      var convertedSetting = converter(settings[settingsKey]);\n      return validatedConstrainedValue({\n        constraintKey: constraintKey,\n        settingsKey: settingsKey,\n        convertedSetting: convertedSetting,\n        capabilities: capabilities,\n        settings: settings,\n        cameraType: cameraType\n      });\n    }\n    if (capabilities.focusMode && settings.autoFocus !== undefined) {\n      constraints.focusMode = validatedInternalConstrainedValue('focusMode', 'autoFocus', CapabilityUtils.convertAutoFocusJSONToNative);\n    }\n    if (capabilities.torch && settings.flashMode !== undefined) {\n      constraints.torch = validatedInternalConstrainedValue('torch', 'flashMode', CapabilityUtils.convertFlashModeJSONToNative);\n    }\n    if (capabilities.whiteBalanceMode && settings.whiteBalance !== undefined) {\n      constraints.whiteBalanceMode = validatedInternalConstrainedValue('whiteBalanceMode', 'whiteBalance', CapabilityUtils.convertWhiteBalanceJSONToNative);\n    }\n    try {\n      yield track.applyConstraints({\n        advanced: [constraints]\n      });\n    } catch (error) {\n      if (__DEV__) console.warn('Failed to apply constraints', error);\n    }\n  });\n  return _onCapabilitiesReady.apply(this, arguments);\n}\nfunction stopMediaStream(stream) {\n  if (!stream) {\n    return;\n  }\n  if (stream.getAudioTracks) {\n    stream.getAudioTracks().forEach(function (track) {\n      return track.stop();\n    });\n  }\n  if (stream.getVideoTracks) {\n    stream.getVideoTracks().forEach(function (track) {\n      return track.stop();\n    });\n  }\n  if (isMediaStreamTrack(stream)) {\n    stream.stop();\n  }\n}\nfunction setVideoSource(video, stream) {\n  var _window$URL$createObj;\n  var createObjectURL = (_window$URL$createObj = window.URL.createObjectURL) != null ? _window$URL$createObj : window.webkitURL.createObjectURL;\n  if (typeof video.srcObject !== 'undefined') {\n    video.srcObject = stream;\n  } else if (typeof video.mozSrcObject !== 'undefined') {\n    video.mozSrcObject = stream;\n  } else if (stream && createObjectURL) {\n    video.src = createObjectURL(stream);\n  }\n  if (!stream) {\n    var _window$URL$revokeObj, _ref2, _video$src;\n    var revokeObjectURL = (_window$URL$revokeObj = window.URL.revokeObjectURL) != null ? _window$URL$revokeObj : window.webkitURL.revokeObjectURL;\n    var source = (_ref2 = (_video$src = video.src) != null ? _video$src : video.srcObject) != null ? _ref2 : video.mozSrcObject;\n    if (revokeObjectURL && typeof source === 'string') {\n      revokeObjectURL(source);\n    }\n  }\n}\nfunction isCapabilityAvailable(video, keyName) {\n  var stream = video.srcObject;\n  if (stream instanceof MediaStream) {\n    var _videoTrack$getCapabi;\n    var videoTrack = stream.getVideoTracks()[0];\n    return videoTrack.getCapabilities == null || (_videoTrack$getCapabi = videoTrack.getCapabilities()) == null ? void 0 : _videoTrack$getCapabi[keyName];\n  }\n  return false;\n}\nfunction isMediaStreamTrack(input) {\n  return typeof input.stop === 'function';\n}\nfunction convertNormalizedSetting(range, value) {\n  if (!value) {\n    return;\n  }\n  var converted = convertRange(value, [range.min, range.max]);\n  return Math.min(range.max, Math.max(range.min, converted));\n}\nfunction convertRange(value, r2) {\n  var r1 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [0, 1];\n  return (value - r1[0]) * (r2[1] - r2[0]) / (r1[1] - r1[0]) + r2[0];\n}\nfunction validatedConstrainedValue(props) {\n  var constraintKey = props.constraintKey,\n    settingsKey = props.settingsKey,\n    convertedSetting = props.convertedSetting,\n    capabilities = props.capabilities,\n    settings = props.settings,\n    cameraType = props.cameraType;\n  var setting = settings[settingsKey];\n  if (Array.isArray(capabilities[constraintKey]) && convertedSetting && !capabilities[constraintKey].includes(convertedSetting)) {\n    if (__DEV__) {\n      console.warn(` { ${settingsKey}: \"${setting}\" } (converted to \"${convertedSetting}\" in the browser) is not supported for camera type \"${cameraType}\" in your browser. Using the default value instead.`);\n    }\n    return undefined;\n  }\n  return convertedSetting;\n}","map":{"version":3,"names":["_invariant","_interopRequireDefault","require","CapabilityUtils","_interopRequireWildcard","_WebConstants","_WebUserMediaManager","_Camera","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","getImageSize","videoWidth","videoHeight","scale","width","ratio","height","toDataURL","canvas","imageType","quality","invariant","values","ImageType","includes","join","format","ImageTypeFormat","jpg","hasValidConstraints","preferredCameraType","undefined","ensureCameraPictureOptions","config","captureOptions","png","isImageMirror","key","DEFAULT_QUALITY","captureImageData","video","pictureOptions","arguments","length","readyState","HAVE_ENOUGH_DATA","captureImageContext","context","getContext","alpha","imageData","getImageData","_ref","_ref$scale","_ref$isImageMirror","_getImageSize","document","createElement","Error","setTransform","drawImage","captureImage","_config$quality","getSupportedConstraints","navigator","mediaDevices","getIdealConstraints","preferredConstraints","audio","MinimumConstraints","supports","facingMode","CameraType","CameraTypeToFacingMode","isWebKit","_defineProperty2","ideal","isMediaTrackConstraints","input","getPreferredStreamDevice","_x","_x2","_x3","_getPreferredStreamDevice","apply","_asyncToGenerator2","preferredWidth","preferredHeight","getStreamDevice","error","OverconstrainedError","constraint","nextCameraType","back","front","_x4","_x5","_x6","_getStreamDevice","constraints","stream","requestUserMediaAsync","test","userAgent","compareStreams","b","settingsA","getTracks","getSettings","settingsB","deviceId","capture","settings","base64","capturedPicture","uri","_settings$width","_settings$height","exif","onPictureSaved","syncTrackCapabilities","_x7","_x8","_syncTrackCapabilities","cameraType","getVideoTracks","Promise","all","map","track","onCapabilitiesReady","_x9","_x10","_onCapabilitiesReady","getCapabilities","capabilities","clampedValues","property","convertNormalizedSetting","validatedInternalConstrainedValue","constraintKey","settingsKey","converter","convertedSetting","validatedConstrainedValue","focusMode","autoFocus","convertAutoFocusJSONToNative","torch","flashMode","convertFlashModeJSONToNative","whiteBalanceMode","whiteBalance","convertWhiteBalanceJSONToNative","applyConstraints","advanced","__DEV__","console","warn","stopMediaStream","getAudioTracks","forEach","stop","isMediaStreamTrack","setVideoSource","_window$URL$createObj","createObjectURL","window","URL","webkitURL","srcObject","mozSrcObject","src","_window$URL$revokeObj","_ref2","_video$src","revokeObjectURL","source","isCapabilityAvailable","keyName","MediaStream","_videoTrack$getCapabi","videoTrack","range","value","converted","convertRange","min","max","Math","r2","r1","props","setting","Array","isArray"],"sources":["F:\\node\\vision\\node_modules\\expo-camera\\src\\web\\WebCameraUtils.ts"],"sourcesContent":["/* eslint-env browser */\nimport invariant from 'invariant';\n\nimport * as CapabilityUtils from './WebCapabilityUtils';\nimport { CameraTypeToFacingMode, ImageTypeFormat, MinimumConstraints } from './WebConstants';\nimport { requestUserMediaAsync } from './WebUserMediaManager';\nimport {\n  CameraType,\n  CameraCapturedPicture,\n  ImageSize,\n  ImageType,\n  WebCameraSettings,\n  CameraPictureOptions,\n} from '../legacy/Camera.types';\n\ninterface ConstrainLongRange {\n  max?: number;\n  min?: number;\n  exact?: number;\n  ideal?: number;\n}\n\nexport function getImageSize(videoWidth: number, videoHeight: number, scale: number): ImageSize {\n  const width = videoWidth * scale;\n  const ratio = videoWidth / width;\n  const height = videoHeight / ratio;\n\n  return {\n    width,\n    height,\n  };\n}\n\nexport function toDataURL(\n  canvas: HTMLCanvasElement,\n  imageType: ImageType,\n  quality: number\n): string {\n  invariant(\n    Object.values(ImageType).includes(imageType),\n    `expo-camera: ${imageType} is not a valid ImageType. Expected a string from: ${Object.values(\n      ImageType\n    ).join(', ')}`\n  );\n\n  const format = ImageTypeFormat[imageType];\n  if (imageType === ImageType.jpg) {\n    invariant(\n      quality <= 1 && quality >= 0,\n      `expo-camera: ${quality} is not a valid image quality. Expected a number from 0...1`\n    );\n    return canvas.toDataURL(format, quality);\n  } else {\n    return canvas.toDataURL(format);\n  }\n}\n\nexport function hasValidConstraints(\n  preferredCameraType?: CameraType,\n  width?: number | ConstrainLongRange,\n  height?: number | ConstrainLongRange\n): boolean {\n  return preferredCameraType !== undefined && width !== undefined && height !== undefined;\n}\n\nfunction ensureCameraPictureOptions(config: CameraPictureOptions): CameraPictureOptions {\n  const captureOptions = {\n    scale: 1,\n    imageType: ImageType.png,\n    isImageMirror: false,\n  };\n\n  for (const key in config) {\n    if (key in config && config[key] !== undefined && key in captureOptions) {\n      captureOptions[key] = config[key];\n    }\n  }\n  return captureOptions;\n}\n\nconst DEFAULT_QUALITY = 0.92;\n\nexport function captureImageData(\n  video: HTMLVideoElement | null,\n  pictureOptions: Pick<CameraPictureOptions, 'scale' | 'isImageMirror'> = {}\n): ImageData | null {\n  if (!video || video.readyState !== video.HAVE_ENOUGH_DATA) {\n    return null;\n  }\n  const canvas = captureImageContext(video, pictureOptions);\n\n  const context = canvas.getContext('2d', { alpha: false });\n  if (!context || !canvas.width || !canvas.height) {\n    return null;\n  }\n\n  const imageData = context.getImageData(0, 0, canvas.width, canvas.height);\n  return imageData;\n}\n\nexport function captureImageContext(\n  video: HTMLVideoElement,\n  { scale = 1, isImageMirror = false }: Pick<CameraPictureOptions, 'scale' | 'isImageMirror'>\n): HTMLCanvasElement {\n  const { videoWidth, videoHeight } = video;\n  const { width, height } = getImageSize(videoWidth, videoHeight, scale!);\n\n  // Build the canvas size and draw the camera image to the context from video\n  const canvas = document.createElement('canvas');\n  canvas.width = width;\n  canvas.height = height;\n  const context = canvas.getContext('2d', { alpha: false });\n\n  if (!context) {\n    // Should never be called\n    throw new Error('Context is not defined');\n  }\n  // sharp image details\n  // context.imageSmoothingEnabled = false;\n\n  // Flip horizontally (as css transform: rotateY(180deg))\n  if (isImageMirror) {\n    context.setTransform(-1, 0, 0, 1, canvas.width, 0);\n  }\n\n  context.drawImage(video, 0, 0, width, height);\n\n  return canvas;\n}\n\nexport function captureImage(\n  video: HTMLVideoElement,\n  pictureOptions: CameraPictureOptions\n): string {\n  const config = ensureCameraPictureOptions(pictureOptions);\n  const canvas = captureImageContext(video, config);\n  const { imageType, quality = DEFAULT_QUALITY } = config;\n  return toDataURL(canvas, imageType!, quality);\n}\n\nfunction getSupportedConstraints(): MediaTrackSupportedConstraints | null {\n  if (navigator.mediaDevices && navigator.mediaDevices.getSupportedConstraints) {\n    return navigator.mediaDevices.getSupportedConstraints();\n  }\n  return null;\n}\n\nexport function getIdealConstraints(\n  preferredCameraType: CameraType,\n  width?: number | ConstrainLongRange,\n  height?: number | ConstrainLongRange\n): MediaStreamConstraints {\n  const preferredConstraints: MediaStreamConstraints = {\n    audio: false,\n    video: {},\n  };\n\n  if (hasValidConstraints(preferredCameraType, width, height)) {\n    return MinimumConstraints;\n  }\n\n  const supports = getSupportedConstraints();\n  // TODO(Bacon): Test this\n  if (!supports || !supports.facingMode || !supports.width || !supports.height) {\n    return MinimumConstraints;\n  }\n\n  if (preferredCameraType && Object.values(CameraType).includes(preferredCameraType)) {\n    const facingMode = CameraTypeToFacingMode[preferredCameraType];\n    if (isWebKit()) {\n      const key = facingMode === 'user' ? 'exact' : 'ideal';\n      (preferredConstraints.video as MediaTrackConstraints).facingMode = {\n        [key]: facingMode,\n      };\n    } else {\n      (preferredConstraints.video as MediaTrackConstraints).facingMode = {\n        ideal: CameraTypeToFacingMode[preferredCameraType],\n      };\n    }\n  }\n\n  if (isMediaTrackConstraints(preferredConstraints.video)) {\n    preferredConstraints.video.width = width;\n    preferredConstraints.video.height = height;\n  }\n\n  return preferredConstraints;\n}\n\nfunction isMediaTrackConstraints(input: any): input is MediaTrackConstraints {\n  return input && typeof input.video !== 'boolean';\n}\n\n/**\n * Invoke getStreamDevice a second time with the opposing camera type if the preferred type cannot be retrieved.\n *\n * @param preferredCameraType\n * @param preferredWidth\n * @param preferredHeight\n */\nexport async function getPreferredStreamDevice(\n  preferredCameraType: CameraType,\n  preferredWidth?: number | ConstrainLongRange,\n  preferredHeight?: number | ConstrainLongRange\n): Promise<MediaStream> {\n  try {\n    return await getStreamDevice(preferredCameraType, preferredWidth, preferredHeight);\n  } catch (error) {\n    // A hack on desktop browsers to ensure any camera is used.\n    // eslint-disable-next-line no-undef\n    if (error instanceof OverconstrainedError && error.constraint === 'facingMode') {\n      const nextCameraType =\n        preferredCameraType === CameraType.back ? CameraType.front : CameraType.back;\n      return await getStreamDevice(nextCameraType, preferredWidth, preferredHeight);\n    }\n    throw error;\n  }\n}\n\nexport async function getStreamDevice(\n  preferredCameraType: CameraType,\n  preferredWidth?: number | ConstrainLongRange,\n  preferredHeight?: number | ConstrainLongRange\n): Promise<MediaStream> {\n  const constraints: MediaStreamConstraints = getIdealConstraints(\n    preferredCameraType,\n    preferredWidth,\n    preferredHeight\n  );\n  const stream: MediaStream = await requestUserMediaAsync(constraints);\n  return stream;\n}\n\nexport function isWebKit(): boolean {\n  return /WebKit/.test(navigator.userAgent) && !/Edg/.test(navigator.userAgent);\n}\n\nexport function compareStreams(a: MediaStream | null, b: MediaStream | null): boolean {\n  if (!a || !b) {\n    return false;\n  }\n  const settingsA = a.getTracks()[0].getSettings();\n  const settingsB = b.getTracks()[0].getSettings();\n  return settingsA.deviceId === settingsB.deviceId;\n}\n\nexport function capture(\n  video: HTMLVideoElement,\n  settings: MediaTrackSettings,\n  config: CameraPictureOptions\n): CameraCapturedPicture {\n  const base64 = captureImage(video, config);\n\n  const capturedPicture: CameraCapturedPicture = {\n    uri: base64,\n    base64,\n    width: 0,\n    height: 0,\n  };\n\n  if (settings) {\n    const { width = 0, height = 0 } = settings;\n    capturedPicture.width = width;\n    capturedPicture.height = height;\n    capturedPicture.exif = settings;\n  }\n\n  if (config.onPictureSaved) {\n    config.onPictureSaved(capturedPicture);\n  }\n  return capturedPicture;\n}\n\nexport async function syncTrackCapabilities(\n  cameraType: CameraType,\n  stream: MediaStream | null,\n  settings: WebCameraSettings = {}\n): Promise<void> {\n  if (stream?.getVideoTracks) {\n    await Promise.all(\n      stream.getVideoTracks().map((track) => onCapabilitiesReady(cameraType, track, settings))\n    );\n  }\n}\n\n// https://developer.mozilla.org/en-US/docs/Web/API/MediaTrackConstraints\nasync function onCapabilitiesReady(\n  cameraType: CameraType,\n  track: MediaStreamTrack,\n  settings: WebCameraSettings = {}\n): Promise<void> {\n  if (typeof track.getCapabilities !== 'function') {\n    return;\n  }\n\n  const capabilities = track.getCapabilities();\n\n  // Create an empty object because if you set a constraint that isn't available an error will be thrown.\n  const constraints: MediaTrackConstraintSet = {};\n\n  // TODO(Bacon): Add `pointsOfInterest` support\n  const clampedValues = [\n    'exposureCompensation',\n    'colorTemperature',\n    'iso',\n    'brightness',\n    'contrast',\n    'saturation',\n    'sharpness',\n    'focusDistance',\n    'zoom',\n  ];\n\n  for (const property of clampedValues) {\n    if (capabilities[property]) {\n      constraints[property] = convertNormalizedSetting(capabilities[property], settings[property]);\n    }\n  }\n\n  function validatedInternalConstrainedValue<IConvertedType>(\n    constraintKey: string,\n    settingsKey: string,\n    converter: (settingValue: any) => IConvertedType\n  ) {\n    const convertedSetting = converter(settings[settingsKey]);\n    return validatedConstrainedValue({\n      constraintKey,\n      settingsKey,\n      convertedSetting,\n      capabilities,\n      settings,\n      cameraType,\n    });\n  }\n\n  if (capabilities.focusMode && settings.autoFocus !== undefined) {\n    constraints.focusMode = validatedInternalConstrainedValue<MediaTrackConstraintSet['focusMode']>(\n      'focusMode',\n      'autoFocus',\n      CapabilityUtils.convertAutoFocusJSONToNative\n    );\n  }\n\n  if (capabilities.torch && settings.flashMode !== undefined) {\n    constraints.torch = validatedInternalConstrainedValue<MediaTrackConstraintSet['torch']>(\n      'torch',\n      'flashMode',\n      CapabilityUtils.convertFlashModeJSONToNative\n    );\n  }\n\n  if (capabilities.whiteBalanceMode && settings.whiteBalance !== undefined) {\n    constraints.whiteBalanceMode = validatedInternalConstrainedValue<\n      MediaTrackConstraintSet['whiteBalanceMode']\n    >('whiteBalanceMode', 'whiteBalance', CapabilityUtils.convertWhiteBalanceJSONToNative);\n  }\n\n  try {\n    await track.applyConstraints({ advanced: [constraints] });\n  } catch (error) {\n    if (__DEV__) console.warn('Failed to apply constraints', error);\n  }\n}\n\nexport function stopMediaStream(stream: MediaStream | null) {\n  if (!stream) {\n    return;\n  }\n  if (stream.getAudioTracks) {\n    stream.getAudioTracks().forEach((track) => track.stop());\n  }\n  if (stream.getVideoTracks) {\n    stream.getVideoTracks().forEach((track) => track.stop());\n  }\n  if (isMediaStreamTrack(stream)) {\n    stream.stop();\n  }\n}\n\nexport function setVideoSource(\n  video: HTMLVideoElement,\n  stream: MediaStream | MediaSource | Blob | null\n): void {\n  const createObjectURL = window.URL.createObjectURL ?? window.webkitURL.createObjectURL;\n\n  if (typeof video.srcObject !== 'undefined') {\n    video.srcObject = stream;\n  } else if (typeof (video as any).mozSrcObject !== 'undefined') {\n    (video as any).mozSrcObject = stream;\n  } else if (stream && createObjectURL) {\n    video.src = createObjectURL(stream as MediaSource | Blob);\n  }\n\n  if (!stream) {\n    const revokeObjectURL = window.URL.revokeObjectURL ?? window.webkitURL.revokeObjectURL;\n    const source = video.src ?? video.srcObject ?? (video as any).mozSrcObject;\n    if (revokeObjectURL && typeof source === 'string') {\n      revokeObjectURL(source);\n    }\n  }\n}\n\nexport function isCapabilityAvailable(video: HTMLVideoElement, keyName: string): boolean {\n  const stream = video.srcObject;\n\n  if (stream instanceof MediaStream) {\n    const videoTrack = stream.getVideoTracks()[0];\n    return videoTrack.getCapabilities?.()?.[keyName];\n  }\n\n  return false;\n}\n\nfunction isMediaStreamTrack(input: any): input is MediaStreamTrack {\n  return typeof input.stop === 'function';\n}\n\nfunction convertNormalizedSetting(range: MediaSettingsRange, value?: number): number | undefined {\n  if (!value) {\n    return;\n  }\n  // convert the normalized incoming setting to the native camera zoom range\n  const converted = convertRange(value, [range.min, range.max]);\n  // clamp value so we don't get an error\n  return Math.min(range.max, Math.max(range.min, converted));\n}\n\nfunction convertRange(value: number, r2: number[], r1: number[] = [0, 1]): number {\n  return ((value - r1[0]) * (r2[1] - r2[0])) / (r1[1] - r1[0]) + r2[0];\n}\n\nfunction validatedConstrainedValue<T>(props: {\n  constraintKey: string;\n  settingsKey: string;\n  convertedSetting: T;\n  capabilities: MediaTrackCapabilities;\n  settings: WebCameraSettings;\n  cameraType: string;\n}): T | undefined {\n  const { constraintKey, settingsKey, convertedSetting, capabilities, settings, cameraType } =\n    props;\n  const setting = settings[settingsKey];\n  if (\n    Array.isArray(capabilities[constraintKey]) &&\n    convertedSetting &&\n    !capabilities[constraintKey].includes(convertedSetting)\n  ) {\n    if (__DEV__) {\n      // Only warn in dev mode.\n      console.warn(\n        ` { ${settingsKey}: \"${setting}\" } (converted to \"${convertedSetting}\" in the browser) is not supported for camera type \"${cameraType}\" in your browser. Using the default value instead.`\n      );\n    }\n    return undefined;\n  }\n  return convertedSetting;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}